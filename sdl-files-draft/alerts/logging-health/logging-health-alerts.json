{
    description: "[Log Health] Less S1 EDR Event Types than expected",
    evaluationFrequencyMinutes: 60,
    gracePeriodMinutes: 0,
    renotifyPeriodMinutes: 60,
    resolutionDelayMinutes: 0,
    trigger: "tableRows:7 days(dataSource.name ='SentinelOne' | group EventTypeCount = estimate_distinct(event.type) by timebucket('1hour')| filter EventTypeCount < 40) > 1",
    note: "Looks for situations in which the number of unique EDR event types is lower than expected. If this fires, it indicates that there is something wrong with logging of EDR telemetry (Deep Visibility)"
  },
  {
    description: "[Log Health] Log Source logging below 10% of usual volume",
    evaluationFrequencyMinutes: 60,
    gracePeriodMinutes: 0,
    renotifyPeriodMinutes: 60,
    resolutionDelayMinutes: 0,
    trigger: "tableRows:2 hours(| join a = (tag = "logvolume.tracker" | columns dataSource.name, log.count, time.hour), b = (tag = 'logvolume.tracker' | group p50.logs=p50(log.count) by dataSource.name) on dataSource.name | let log.rate.ratio = (log.count / p50.logs) | filter log.rate.ratio < .10 | sort +log.rate.ratio ) > 1",
    note: "Looks for log sources (based on dataSource.name field) that are logging below their usual rate. Pre-requisites: must have set up the PowerQuery Monitors 'logvolume.tracker.json' and 'logvolume.tracker.p50json'"
  },
  {
    description: "[Log Health] Microsoft Azure logging rate below 10% of usual volume for 1 or more Workloads",
    evaluationFrequencyMinutes: 1440,
    gracePeriodMinutes: 0,
    renotifyPeriodMinutes: 60,
    resolutionDelayMinutes: 0,
    trigger: "tableRows:7 days(| join a = (|join a=(parser = 'ms365' Workload = * | group LogsLast7Days = count() by  Workload | let AvgDailyLogsLast7Days = LogsLast7Days /7 | columns Workload, AvgDailyLogsLast7Days), b= (parser = 'ms365' Workload = * | group count = count() by timestamp= timebucket('1d'), Workload | let Yesterday = queryend() - (24 * 60 * 60 * 1000000000) | let data = timestamp<=Yesterday? "baseline" : "current" | filter data="current") on Workload | let Last24hrsLogRateVs7DayAvg = (count / AvgDailyLogsLast7Days | sort -Last24hrsLogRateVs7DayAvg) > 1",
    note: "Alerts on Workloads from Azure Event Hubs (Security Graph API, Events API) that have had less than 10% of their usual volume in the last 24 hours (compared to 7 day baseline)'"
  },

  




  